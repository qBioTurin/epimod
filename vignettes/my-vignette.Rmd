---
title: "EpiMod: an example of analisys"
author: "Beccuti Marco, Castagno Paolo, Pernice Simone"
output: 
  pdf_document:
    toc: true
    toc_depth: 3
    fig_caption: yes
bibliography: biblio.bib  
vignette: >
  %\VignetteIndexEntry{my-vignette}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}

---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r wrap-hook,include = FALSE }
library(knitr)
hook_output = knit_hooks$get('output')
knit_hooks$set(output = function(x, options) {
  # this hook is used only when the linewidth option is not NULL
  if (!is.null(n <- options$linewidth)) {
    x = knitr:::split_lines(x)
    # any lines wider than n should be wrapped
    if (any(nchar(x) > n)) x = strwrap(x, width = n)
    x = paste(x, collapse = '\n')
  }
  hook_output(x, options)
})
```

## The Prey-Predator model

The Lotka–Volterra equations, also known as the predator–prey equations, are a pair of first-order nonlinear differential equations, frequently used to describe the dynamics of biological systems in which two species interact, one as a predator and the other as prey. The populations change through time according to the pair of equations:

$$ \begin{aligned} \frac{dx}{dt} &= \alpha x-\beta xy,\\
{\frac {dy}{dt}}&=\delta xy-\gamma y, \end{aligned}$$

where:

1. $x$ is the number of prey (for example, rabbits);
2. $y$ is the number of some predator (for example, foxes);
3. ${\tfrac {dy}{dt}}$ and ${\tfrac {dx}{dt}}$ represent the instantaneous growth rates of the two populations;
4. $t$ represents time;
5. $\alpha,\ \beta,\ \gamma,\ \theta$ are positive real parameters describing the interaction of the two species.


## Guideline for epimod package
### How to start 

Before starting the analysis we have to download the Docker containers.


```{r}
library(epimod)

downloadContainers()
``` 

### Something to know
All the files used in this guide are stored in the folder *Example* inside the *epimod* package.
All the functions print  the following strings:

- *Docker ID is:*, meaning that ...;
- *Docker exit status: 0*, meaning that ... .
###  Model generation

```{r, linewidth = 80}

model_generation(net_fname = "PredyPredator.PNPRO")

``` 


###  Sensitivity analysis

To execute the sensitivity analysis of the model, that is ... , we must define the following objects:

1. parameters_fname (*Functions_list.csv*): significato delle colonne, e che serve il ; come sep, spazi non nei path ;
2. functions_fname (*Functions.R*): ... ;
3. target_value_fname (*predator.R*): ... .

Assuming the following fixed rates:
$\alpha = 2/3,\ \beta = 4/3,\ \gamma = \theta = 1.$
Than we change the prey and predator initial conditions from 200 to 1800, knowing that the fixed point is at $x(0) = 1000, y(0)=500$.
In *Functions_list.csv* we will write the function name to exploit for sampling the values in the choosen range. 

```{r}
getwd()
read.csv("Functions_list.csv", header=FALSE)
```

```{r, linewidth = 80 }

sensitivity<-sensitivity_analysis(n_config = 10,
                     parameters_fname = "Functions_list.csv",
                     functions_fname = "Functions.R",
                     solver_fname = "PredyPredator.solver",
                     f_time = 20,
                     s_time = .1
                     )

##############################
## Let draw the orbits characterizing the phase-space
##############################

library(ggplot2)

load("./PredyPredator/results/PredyPredator-sensitivity.RData")

listFile<-list.files("./PredyPredator/results/", pattern = ".trace")

configID<-t(sapply(1:length(listFile),
       function(x){
           return(c(x,config[[1]][[x]][[3]]))
       }) )

#colnames(configID)<-c("ID","Prey","Predator")

ListTraces<-lapply(1:length(listFile),
              function(x){
                trace.tmp=read.csv(paste0("./PredyPredator/results/",listFile[x]), sep = "")
                trace.tmp=data.frame(trace.tmp,ID=configID[which(configID[,1]==x),2])
                return(trace.tmp)
              })

traces <- do.call("rbind", ListTraces)

ggplot(traces,aes(x=Prey,y=Predator,group=ID,col=ID) )+
    geom_path(arrow=arrow(length=unit(0.3,"cm"),ends="first"))

``` 
